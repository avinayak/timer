<!DOCTYPE html>
<html ng-app="app">
<head>
    <title>Timer</title>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-78455977-1', 'auto');
      ga('send', 'pageview');

    </script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <style type="text/css">
        .outer {
            display: table;
            position: absolute;
            height: 100%;
            width: 100%;
        }

        .middle {
            display: table-cell;
            vertical-align: middle;
        }

        .inner {
            margin-left: auto;
            margin-right: auto; 
        }
        .t-counter-types{
            background-color: #fff;
            border: none;
            border-bottom: 1px solid #aaa;
            border-radius: 0px;
            margin-bottom: 2px;
            width: auto;
            padding: 6px 0px;
        }
        .t-select{
            box-shadow: none;
            display: inline-block;
            margin: 0px -2px;
            width:auto;
            height: auto;
            border: none;
            margin-bottom: 2px;
            border-bottom: 1px solid #aaa;
            border-radius: 0px;
        }
        select:focus {
          outline: 0;
            box-shadow: none !important;
        }

        #t-year-field {
          width: 45px;
          border-bottom: 1px solid #555;
          box-shadow: none;
          padding-bottom: 3px;
          border: none;
          border-bottom: 1px solid #aaa;
          margin-bottom: 3px;
          margin-left: -2px;
          text-align: center;
          padding: 5px 0px;
        }
        .t-colonsep{
            font-size: 70px;
            color: #555;
        }
        .t-sample-link{
            text-align: left;
        }
        .t-static-text{
            padding: 20px;
        }
        #t-uppertext{
            margin-bottom: 20px;     
        }
        input[type='text']{
            border: none;
            border-bottom: 1px solid #aaa;
            border-radius: 0px;
            margin: 0px;
            box-shadow: none;
        }
        input[type='text']:focus{
            border: none;
            border-bottom: 1px solid #aaa;
            border-radius: 0px;
            box-shadow: none;
        }
        .t-surr-text{
            /*border-bottom:1px solid #aaa ;*/
            background: #eee;
            display: inline-block;
            min-width: 10px;
        }
        .t-timertext{
            /*border-bottom: 1px solid #aaa;*/
            padding-bottom: 7px;
        }
        .t-hor-space{
            font-size: -3px;
        }
        #t-newwindow {
            text-align: left;
            margin: 40px 0px;
        }
        #t-clock{
          font-size: 100px;
          line-height: 100px;
        }
        .t-format-iconbar{
            width: 20px;
            display: inline-block;  
        }
        .t-toolbar {
            position: relative;
            top: 15px;
        }
    </style>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.4/angular.js"></script>
    <script src="//angular-ui.github.io/ui-router/release/angular-ui-router.js"></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js'></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/1.3.3/ui-bootstrap.js"></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/angular-moment/1.0.0-beta.6/angular-moment.min.js'></script>
    <script src='moment-duration-format.js'></script>
    <script>
      var app = angular.module('app', ["ui.router",'angularMoment']);
      var smaz = {
        // Our compression codebook, used for compression
        codebook: {
          " ": 0, "the": 1, "e": 2, "t": 3, "a": 4, "of": 5, "o": 6, "and": 7, "i": 8, "n": 9, "s": 10, "e ": 11, "r": 12, " th": 13, " t": 14, "in": 15, "he": 16, "th": 17, "h": 18, "he ": 19, "to": 20, "\r\n": 21, "l": 22, "s ": 23, "d": 24, " a": 25, "an": 26, "er": 27, "c": 28, " o": 29, "d ": 30, "on": 31, " of": 32, "re": 33, "of ": 34, "t ": 35, ", ": 36, "is": 37, "u": 38, "at": 39, "   ": 40, "n ": 41, "or": 42, "which": 43, "f": 44, "m": 45, "as": 46, "it": 47, "that": 48, "\n": 49, "was": 50, "en": 51, "  ": 52, " w": 53, "es": 54, " an": 55, " i": 56, "\r": 57, "f ": 58, "g": 59, "p": 60, "nd": 61, " s": 62, "nd ": 63, "ed ": 64, "w": 65, "ed": 66, "http://": 67, "for": 68, "te": 69, "ing": 70, "y ": 71, "The": 72, " c": 73, "ti": 74, "r ": 75, "his": 76, "st": 77, " in": 78, "ar": 79, "nt": 80, ",": 81, " to": 82, "y": 83, "ng": 84, " h": 85, "with": 86, "le": 87, "al": 88, "to ": 89, "b": 90, "ou": 91, "be": 92, "were": 93, " b": 94, "se": 95, "o ": 96, "ent": 97, "ha": 98, "ng ": 99, "their": 100, "\"": 101, "hi": 102, "from": 103, " f": 104, "in ": 105, "de": 106, "ion": 107, "me": 108, "v": 109, ".": 110, "ve": 111, "all": 112, "re ": 113, "ri": 114, "ro": 115, "is ": 116, "co": 117, "f t": 118, "are": 119, "ea": 120, ". ": 121, "her": 122, " m": 123, "er ": 124, " p": 125, "es ": 126, "by": 127, "they": 128, "di": 129, "ra": 130, "ic": 131, "not": 132, "s,": 133, "d t": 134, "at ": 135, "ce": 136, "la": 137, "h ": 138, "ne": 139, "as ": 140, "tio": 141, "on ": 142, "n t": 143, "io": 144, "we": 145, " a ": 146, "om": 147, ", a": 148, "s o": 149, "ur": 150, "li": 151, "ll": 152, "ch": 153, "had": 154, "this": 155, "e t": 156, "g ": 157, "e\r\n": 158, " wh": 159, "ere": 160, " co": 161, "e o": 162, "a ": 163, "us": 164, " d": 165, "ss": 166, "\n\r\n": 167, "\r\n\r": 168, "=\"": 169, " be": 170, " e": 171, "s a": 172, "ma": 173, "one": 174, "t t": 175, "or ": 176, "but": 177, "el": 178, "so": 179, "l ": 180, "e s": 181, "s,": 182, "no": 183, "ter": 184, " wa": 185, "iv": 186, "ho": 187, "e a": 188, " r": 189, "hat": 190, "s t": 191, "ns": 192, "ch ": 193, "wh": 194, "tr": 195, "ut": 196, "/": 197, "have": 198, "ly ": 199, "ta": 200, " ha": 201, " on": 202, "tha": 203, "-": 204, " l": 205, "ati": 206, "en ": 207, "pe": 208, " re": 209, "there": 210, "ass": 211, "si": 212, " fo": 213, "wa": 214, "ec": 215, "our": 216, "who": 217, "its": 218, "z": 219, "fo": 220, "rs": 221, ">": 222, "ot": 223, "un": 224, "<": 225, "im": 226, "th ": 227, "nc": 228, "ate": 229, "><": 230, "ver": 231, "ad": 232, " we": 233, "ly": 234, "ee": 235, " n": 236, "id": 237, " cl": 238, "ac": 239, "il": 240, "</": 241, "rt": 242, " wi": 243, "div": 244, "e, ": 245, " it": 246, "whi": 247, " ma": 248, "ge": 249, "x": 250, "e c": 251, "men": 252, ".com": 253
        },
        
        // Reverse compression codebook, decompression
        reverse_codebook: [
        " ", "the", "e", "t", "a", "of", "o", "and", "i", "n", "s", "e ", "r", " th", " t", "in", "he", "th", "h", "he ", "to", "\r\n", "l", "s ", "d", " a", "an","er", "c", " o", "d ", "on", " of", "re", "of ", "t ", ", ", "is", "u", "at", "   ", "n ", "or", "which", "f", "m", "as", "it", "that", "\n", "was", "en", "  ", " w", "es", " an", " i", "\r", "f ", "g", "p", "nd", " s", "nd ", "ed ", "w", "ed", "http://", "for", "te", "ing", "y ", "The", " c", "ti", "r ", "his", "st", " in", "ar", "nt", ",", " to", "y", "ng", " h", "with", "le", "al", "to ", "b", "ou", "be", "were", " b", "se", "o ", "ent", "ha", "ng ", "their", "\"", "hi", "from", " f", "in ", "de", "ion", "me", "v", ".", "ve", "all", "re ", "ri", "ro", "is ", "co", "f t", "are", "ea", ". ", "her", " m", "er ", " p", "es ", "by", "they", "di", "ra", "ic", "not", "s, ", "d t", "at ", "ce", "la", "h ", "ne", "as ", "tio", "on ", "n t", "io", "we", " a ", "om", ", a", "s o", "ur", "li", "ll", "ch", "had", "this", "e t", "g ", "e\r\n", " wh", "ere", " co", "e o", "a ", "us", " d", "ss", "\n\r\n", "\r\n\r", "=\"", " be", " e", "s a", "ma", "one", "t t", "or ", "but", "el", "so", "l ", "e s", "s,", "no", "ter", " wa", "iv", "ho", "e a", " r", "hat", "s t", "ns", "ch ", "wh", "tr", "ut", "/", "have", "ly ", "ta", " ha", " on", "tha", "-", " l", "ati", "en ", "pe", " re", "there", "ass", "si", " fo", "wa", "ec", "our", "who", "its", "z", "fo", "rs", ">", "ot", "un", "<", "im", "th ", "nc", "ate", "><", "ver", "ad", " we", "ly", "ee", " n", "id", " cl", "ac", "il", "</", "rt", " wi", "div", "e, ", " it", "whi", " ma", "ge", "x", "e c", "men", ".com"],

        flush_verbatim: function(verbatim) {
          var output = [];
          if(verbatim.length > 1) {
            output.push(255);
            output.push(verbatim.length-1);
          } else {
            output.push(254);
          }
          var k = 0;
          for(; k < verbatim.length; k++) {
            output.push(verbatim.charCodeAt(k));
          }
          
          return output;
        },

        compress: function(input) {
          var verbatim = "";
          var output = [];
          var input_index = 0;

          while(input_index < input.length) {
            // Try to lookup substrings into the hash table, starting from the
            // longer to the shorter substrings
            var encoded = false;
            var j = 7;
            
            if(input.length-input_index < 7) {
              j = input.length-input_index;
            }
            
            for(; j > 0; j--) {
              var code = smaz.codebook[input.substr(input_index,j)];
              if(code != undefined) {
                // Match found in the hash table,
                // Flush verbatim bytes if needed
                if(verbatim) {
                  output = output.concat(smaz.flush_verbatim(verbatim));
                  verbatim = "";
                }
                // Emit the byte
                output.push(code);

                input_index += j;
                
                encoded = true;
                break;
              }
            }
            if(!encoded) {
              // Match not found - add the byte to the verbatim buffer
              verbatim += input[input_index];
              input_index++;

              // Flush if we reached the verbatim bytes length limit
              if(verbatim.length == 256) {
                output = output.concat(smaz.flush_verbatim(verbatim));
                verbatim = "";
              }
            }
          }
          
          // Flush verbatim bytes if needed
          if(verbatim) {
            output = output.concat(smaz.flush_verbatim(verbatim));
            verbatim = "";
          }
          
          return new Uint8Array(output);
        },

        decompress: function(input) {
          var output = "";
          var i = 0;
          while(i < input.length) {
            if(input[i] === 254) {
              // Verbatim byte
              if(i+1 >= input.length) {
                throw "Malformed smaz.";
              }
              output += String.fromCharCode(input[i+1]);
              i += 2;
            } else if(input[i] === 255) {
              // Verbatim string
              var j;
              if(i+input[i+1]+2 >= input.length) {
                throw "Malformed smaz.";
              }
              for(j = 0; j < input[i+1]+1; j++) {
                output += String.fromCharCode(input[i+2+j]);
              }
              i += 3+input[i+1];
            } else {
              // Codebook entry
              output += smaz.reverse_codebook[input[i]];
              i++;
            }
          }
            
          return output;
        }
      };

      app.directive('contenteditable', function () {
          return {
              restrict: 'A', // only activate on element attribute
              require: '?ngModel', // get a hold of NgModelController
              link: function (scope, element, attrs, ngModel) {
                  if (!ngModel) return; // do nothing if no ng-model

                  // Specify how UI should be updated
                  ngModel.$render = function () {
                      element.html(ngModel.$viewValue || '');
                  };

                  // Listen for change events to enable binding
                  element.on('blur keyup change', function () {
                      scope.$apply(readViewText);
                  });

                  // No need to initialize, AngularJS will initialize the text based on ng-model attribute

                  // Write data to the model
                  function readViewText() {
                      var html = element.html();
                      // When we clear the content editable the browser leaves a <br> behind
                      // If strip-br attribute is provided then we strip this out
                      if (attrs.stripBr && html == '<br>') {
                          html = '';
                      }
                      ngModel.$setViewValue(html);
                  }
              }
          };
      });

      app.config(function($stateProvider, $urlRouterProvider){

        function range(l,h,s){
          if(!h)
          {
            h=l;l=0;
          }
          var list = [];
          for (var i = l; i <= h; i++) {
              if(!s || i>=10)
                list.push(i);
              else
                list.push('0'+i);
          }
          return list;
        }



        function timer_presentation(type,diff) {
            if(type=='sa'){
              out = moment.duration(diff).as('seconds').toFixed(1);
            }else if(type=='ma'){
              out = moment.duration(diff).as('minutes').toFixed(3);
            }else if(type=='ha'){
              out = moment.duration(diff).as('hours').toFixed(5);
            }else if(type=='da'){
              out = moment.duration(diff).as('days').toFixed(6);
            }else if(type=='ya'){
              out = moment.duration(diff).as('years').toFixed(9);
            }else if(type=='s'){
              out = moment.duration(diff).as('seconds').toFixed(0);
            }else if(type=='m'){
              out = moment.duration(diff).as('minutes').toFixed(0);
            }else if(type=='h'){
              out = moment.duration(diff).as('hours').toFixed(0);
            }else if(type=='d'){
              out = moment.duration(diff).as('days').toFixed(0);
            }else if(type=='y'){
              out = moment.duration(diff).as('years').toFixed(0);
            }else if(type=='tf'){
              out = moment.duration(diff).humanize(true);
            }else if(type=='t'){
              out = moment.duration(diff).format();
            }else if(type=='ts'){
              out = moment.duration(diff).format("y [Years], M [Months], D [Days], H [Hours], m [Minutes] [and] s [Seconds]");
            }
            else{
              out = diff;
            }
            return out.replace("-","");
        }
        
        $urlRouterProvider.otherwise("/");
        
        // Suggestion welcome
        var random_events=[
          {month:'Dec',date:'28',year:'1993',hour:'10',minute:'01',second:'00',period:'PM',type:'ya',left:'It\'s',right:'Years since I was born.'},
          {month:'Dec',date:'28',year:'2016',hour:'10',minute:'01',second:'00',period:'PM',type:'d',left:'You have',right:'Days till your next Birthday.'},
          {month:'Dec',date:'21',year:'2016',hour:'10',minute:'51',second:'00',period:'PM',type:'ts',left:'In 2016 Winter begins',right:'from now.'},
          {month:'Jul',date:'20',year:'2020',hour:'12',minute:'00',second:'00',period:'AM',type:'d',left:'Tokyo Olympics 2020 will commence in',right:'Days.'},
          {month:'Jul',date:'20',year:'1969',hour:'10',minute:'56',second:'00',period:'PM',type:'ts',left:'It\'s been',right:'since man first landed on the Moon.'},
        ];

        var styles = [
          {fontsize:40},
          {fontsize:60},
          {fontsize:80},
          {fontsize:100},
        ];
        $stateProvider
          .state('index', {
              url: "/",
              templateUrl: "watchmaker.html",
              controller:function ($scope,$interval) {
                $scope.countertypes=[
                  {type:'t',text:'Time'},
                  {type:'ts',text:'Time (Simple)'},
                  {type:'tf',text:'Time (Fuzzy)'},
                  {type:'sa',text:'Seconds (Accurate)'},
                  {type:'ma',text:'Minutes (Accurate)'},
                  {type:'ha',text:'Hours (Accurate)'},
                  {type:'da',text:'Days (Accurate)'},
                  {type:'ya',text:'Years (Accurate)'},
                  {type:'s',text:'Seconds'},
                  {type:'m',text:'Minutes'},
                  {type:'h',text:'Hours'},
                  {type:'d',text:'Days'},
                  {type:'y',text:'Years'},
                ];
                $scope.dates = range(1,31);
                $scope.years = range(1990,2100);
                $scope.hours = range(1,12,'pad');
                $scope.minutes = range(0,59,'pad');
                $scope.seconds = range(0,59,'pad');
                $scope.months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Nov','Dec'];
                $scope.periods = ['AM','PM'];
                $scope.styles=styles;
                $scope.toggle_sizes = function () {
                  $scope.style_index=($scope.style_index+1)%$scope.styles.length;
                };
                $scope.style_index=0;
                var randev = random_events[Math.floor(Math.random() * random_events.length)];

                $scope.sdate = randev.date;
                $scope.syear = randev.year;
                $scope.shour = randev.hour;
                $scope.sminute = randev.minute;
                $scope.ssecond = randev.second;
                $scope.smonth = randev.month;
                $scope.speriod = randev.period;
                $scope.stype = randev.type;
                $scope.diff = 0;
                $scope.fromto = "from";
                $scope.lefttext=randev.left;
                $scope.righttext=randev.right;

                $scope.$watch('[smonth,sdate,syear,shour,sminute,ssecond,speriod]', function (newv, oldv) {
                  $scope.mstime = moment.utc(newv[0]+"/"+newv[1]+"/"+newv[2]+" "+newv[3]+":"+newv[4]+":"+newv[5]+" "+newv[6], "MMMM/D/YYYY hh:mm:ss a");
                  $scope.timenow=moment().utc(moment()).local();
                  $scope.diff=$scope.mstime.valueOf()-$scope.timenow.valueOf();
                  if($scope.diff>0)
                      $scope.fromto="to";
                  else
                      $scope.fromto="from";
                }, true);

                $interval(function() {
                  $scope.timenow=moment().utc(moment()).local();
                  $scope.diff=$scope.mstime.valueOf()-$scope.timenow.valueOf();
                  $scope.stimervalue= timer_presentation($scope.stype, $scope.diff);//=
                },100);

              }
          })
          .state('timer', {
            url: "/:type/:left/:time/:right",
            templateUrl: "watch.html",
            controller: function($scope,$stateParams,$interval){
              $scope.type = $stateParams.type;
              $scope.left = unescape($stateParams.left).replace('\&nbsp\;',' ');
              $scope.time = $stateParams.time;
              $scope.right = unescape($stateParams.right).replace('\&nbsp\;',' ');

              $interval(function() {
                $scope.timenow=moment().utc(moment()).local();
                $scope.diff=$scope.time-$scope.timenow.valueOf();
                $scope.stimervalue= timer_presentation($scope.type, $scope.diff);//=
              },100);

            }
          });
      });
    </script>

</head>
<body >
    <div ui-view></div>
</body>